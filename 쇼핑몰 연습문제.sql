--카테고리
CREATE TABLE CATEGORIES (
CATEGORY_ID NUMBER PRIMARY KEY,
CATEGORY_NAME VARCHAR2(100) UNIQUE
);

COMMENT ON COLUMN CATEGORIES.CATEGORY_ID IS '카테고리 ID';
COMMENT ON COLUMN CATEGORIES.CATEGORY_NAME IS '카테고리 이름';

SELECT * FROM CATEGORIES;

INSERT INTO CATEGORIES VALUES(1,'스마트폰');
INSERT INTO CATEGORIES VALUES(2,'TV');
INSERT INTO CATEGORIES VALUES(3,'GAMING');


--상품정보

CREATE TABLE PRODUCTS (
	PRODUCT_ID NUMBER PRIMARY KEY,
	PRODUCT_NAME VARCHAR2(100) NOT NULL,
	PRICE NUMBER DEFAULT 0,
	STOCK_QUANTITY NUMBER DEFAULT 0,
	CATEGORY NUMBER ,
	CONSTRAINT FK_CATEGORIES FOREIGN KEY (CATEGORY)
	REFERENCES CATEGORIES(CATEGORY_ID)
);

COMMENT ON COLUMN PRODUCTS.PRODUCT_ID IS '상품코드';
COMMENT ON COLUMN PRODUCTS.PRODUCT_NAME IS '상품이름';
COMMENT ON COLUMN PRODUCTS.CATEGORY IS '카테고리';
COMMENT ON COLUMN PRODUCTS.PRICE IS '가격';
COMMENT ON COLUMN PRODUCTS.STOCK_QUANTITY IS '재고량';

SELECT * FROM PRODUCTS;


INSERT INTO PRODUCTS VALUES(101,'Apple iPhone 12',1500000, 30, 1);

INSERT INTO PRODUCTS VALUES(102,'Samsung Galaxy S24',1800000,50,1);

INSERT INTO PRODUCTS VALUES(201,'LG OLED TV',3600000,10,2);

INSERT INTO PRODUCTS VALUES(301,'Sony PlayStation 5',700000,15,3);


--고객정보
CREATE TABLE CUSTOMERS(
	CUSTOMER_ID NUMBER PRIMARY KEY,
	NAME VARCHAR2(20) NOT NULL,
	GENDER CHAR(3) CONSTRAINT "CHECK" CHECK(GENDER IN ('남','여')),
	ADDRESS VARCHAR(100),
	PHONE VARCHAR2(30)
);

SELECT * FROM CUSTOMERS;

COMMENT ON COLUMN  CUSTOMERS.CUSTOMER_ID IS '고객ID';
COMMENT ON COLUMN  CUSTOMERS.NAME IS '이름';
COMMENT ON COLUMN  CUSTOMERS.GENDER IS '성별';
COMMENT ON COLUMN  CUSTOMERS.ADDRESS IS '주소';
COMMENT ON COLUMN  CUSTOMERS.PHONE IS '전화번호';

INSERT INTO CUSTOMERS VALUES (1,'홍길동','남','서울시 성동구 왕십리','010-1111-2222');
INSERT INTO CUSTOMERS VALUES (2,'유관순','여','서울시 종로구 안국동','010-3333-1111');



--주문 정보
CREATE TABLE ORDERS(
	ORDER_ID NUMBER PRIMARY KEY,
	ORDER_DATE DATE DEFAULT SYSDATE,
	STATUS CHAR(1) DEFAULT 'N', 
	CUSTOMER_ID NUMBER ,
	CONSTRAINT CK1_STATUS CHECK(STATUS IN ('Y','N')),
	CONSTRAINT FK1_CUSTOMER FOREIGN KEY (CUSTOMER_ID)
	REFERENCES CUSTOMERS(CUSTOMER_ID) ON DELETE CASCADE
);

SELECT * FROM ORDERS;

COMMENT ON COLUMN ORDERS.ORDER_ID IS '주문번호';
COMMENT ON COLUMN ORDERS.CUSTOMER_ID IS '고객ID';
COMMENT ON COLUMN ORDERS.ORDER_DATE IS '주문일';
COMMENT ON COLUMN ORDERS.STATUS IS '처리상태';

INSERT INTO ORDERS VALUES(576,'2024-02-29','N',1);
INSERT INTO ORDERS VALUES(978,'2024-03-11','Y',2);
INSERT INTO ORDERS VALUES(777,'2024-03-11','N',2);
INSERT INTO ORDERS VALUES(134,'2022-12-25','Y',1);
INSERT INTO ORDERS VALUES(499,'2020-01-03','Y',1);



--주문상세정보
CREATE TABLE ORDER_DETAILS(
	ORDER_DETAIL_ID NUMBER PRIMARY KEY,
	QUANTITY NUMBER,
	PRICE_PER_UNIT NUMBER,
	ORDER_ID NUMBER,
	PRODUCT_ID NUMBER,
	CONSTRAINT FK_ORDER_ID FOREIGN KEY (ORDER_ID) REFERENCES ORDERS(ORDER_ID) ON DELETE CASCADE,
	CONSTRAINT FK_PRODUCT_ID FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCTS(PRODUCT_ID) ON DELETE SET NULL
);

COMMENT ON COLUMN ORDER_DETAILS.ORDER_DETAIL_ID IS '주문상세ID';
COMMENT ON COLUMN ORDER_DETAILS.QUANTITY IS '수량';
COMMENT ON COLUMN ORDER_DETAILS.PRICE_PER_UNIT IS '가격';
COMMENT ON COLUMN ORDER_DETAILS.ORDER_ID IS '주문번호';
COMMENT ON COLUMN ORDER_DETAILS.PRODUCT_ID IS '상품코드';

INSERT INTO ORDER_DETAILS VALUES(111,1,1500000,576,101);
INSERT INTO ORDER_DETAILS VALUES(222,2,3600000,978,201);
INSERT INTO ORDER_DETAILS VALUES(333,1,1800000,978,102);
INSERT INTO ORDER_DETAILS VALUES(444,5,700000,777,301);
INSERT INTO ORDER_DETAILS VALUES(555,1,1800000,134,102);
INSERT INTO ORDER_DETAILS VALUES(666,3,3600000,499,201);

SELECT * FROM ORDER_DETAILS ;

COMMIT;


--1번
SELECT NAME 고객명 , ORDER_DATE 주문일, STATUS 처리상태
FROM CUSTOMERS
JOIN ORDERS USING(CUSTOMER_ID)
WHERE STATUS = 'N';

--2번
SELECT ORDER_ID 주문번호, ORDER_DATE 주문날짜, STATUS 처리상태
FROM ORDERS
JOIN CUSTOMERS USING (CUSTOMER_ID)
JOIN  ORDER_DETAILS USING ( ORDER_ID )
WHERE NAME = '홍길동'
AND EXTRACT(YEAR FROM ORDER_DATE) =  '2024'; --DATE 타입

--3번
SELECT ORDER_ID 주문번호, PRODUCT_NAME 상품명, QUANTITY 수량, PRICE 개별금액, PRICE *  QUANTITY 주문별금액합계
FROM ORDER_DETAILS
JOIN PRODUCTS USING(PRODUCT_ID)
JOIN ORDERS USING( ORDER_ID)
JOIN CUSTOMERS USING(CUSTOMER_ID)
WHERE NAME = '유관순'
ORDER BY QUANTITY DESC;
















